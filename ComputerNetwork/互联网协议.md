# 概念

广播：子网络内传播

路由：子网络之间传输

IP协议：为每一台计算机分配IP地址，确定哪些地址在同一个子网络

物理层：翻译硬件的0，1

链接层：规定一组传输多少数据

网络层（IP）：建立主机到主机的通讯

传输层（UDP/TCP）：建立端口到端口的通讯

应用层：规定应用程序的数据格式

# Internet协议

发送一个数据包需要知道两个地址：

* 对方的MAC地址
* 对方的IP地址

MAC地址具有局限性，如果两台电脑不在同一个子网络，就无法知道对方的MAC地址，必须通过网关（路由协议）转发。

Internet协议-静态IP地址：

* 本机的IP地址
* 子网掩码
* 网关的IP地址
* DNS的IP地址

Internet协议-动态IP地址：

* DHCP服务器：每一个子网络中，有一台计算机负责管理本网络的所有IP地址。
* DHCP协议

  * 以太网标头设置本机MAC地址，和接收方MAC地址（因为还不知道，所以填一个广播地址）
  * IP标头设置发出方IP地址和接收方IP地址（两个地址都不知道，分别设置0.0.0.0/255.255.255.255）
  * UDP标头设置发出方端口（68）和接收方端口（67）
* 通过以太网协议广播发送，DHCP服务器通过查看发送方IP和接收方IP确定数据包是发给自己的。
* DHCP服务器读取包中的内容，分配IP地址，然后发送一个DHCP的相应。
* 新加入的计算机收到相应包，于是知道自己的IP地址，子网掩码，网关地址，DNS服务器等参数

DNS服务器：

* 通过已知的DNS服务器（例如8.8.8.8）来解析域名。向DNS服务器的IP地址发送DNS查询数据包。
* 数据包中包含想要解析的域名信息，比如www.google.com.
* DNS接收到请求之后，查找并返回域名对应的IP地址。
* 以上过程是自动完成的，不需要用户的配置或干预。一般在操作系统中，当在浏览器中输入一个网址时，系统自动处理DNS查询的过程。

子网掩码：

* 用来判断IP地址是不是在同一个自网络。两个IP地址与子网掩码做一个二进制的AND运算，计算结果相同则两个设备在同一个子网络，否则不在。

# 应用层协议

1. HTTP部分的内容嵌入在TCP数据包中
2. TCP数据包需要设置端口，接收方（Google）的HTTP端口默认为80，发送方（本机）的端口是一个随机生成的1024-65535之间的整数
3. IP数据包需要设置双方的IP地址，本机和接收方的IP（172.194.72.105-Google-DNS域名解析）都是已知的。
4. 以太网数据包需要设置双方的MAC地址，发送方为本机的网卡MAC地址，接收方网关的MAC地址通过ARP协议得到。

# 服务器响应

* 经过多个网关的转发，假设Google的服务器（172.194.72.105）收到四个以太网数据包
* 根据IP标头的序号，Google将四个包拼起来，取出完整的TCP数据包，然后读里面的“HTTP请求”，接着做出“HTTP响应”，再用TCP协议发回来
* 本机收到HTTP响应以后，就可以将网页显示出来，完成一次网络通信。
