---
title: 计算机网络概念
ccategories:
	- ComputerNetwork
---
# OSI网络模型

## 物理层/实体层

把电脑连接起来的物理手段，主要规定了网络的一些电气特性，负责传输0和1的电信号。将信息编码成电流脉冲或其他信号，用于网上传输。

## 链接层

确定0和1的分组方式，即将比特流封装成帧，在相邻的网络节点之间进行可靠的数据传输。

### 以太网

电脑上的以太网接口，WIFI接口，以太网交换机，路由器上的以太网接口，还有网线都是以太网的组成部分。以太网是一种在局域网内，把附近的设备链接起来，使他们之间可以进行通讯的技术。

### 以太网协议

以太网规定，一组电信号构成一个数据包，叫做帧（Frame）。每一帧分成两个部分：标头（Head）和数据（Date）

* 标头：包含数据包的说明项，比如发送者，接收者，数据类型等，固定长度位18字节。
* 数据：数据包的具体内容，最短为46字节，最长为1500字节

### MAC地址

MAC地址是用来标识发送者和接收者。以太网规定，接入网络的所有设备，都必须具有“网卡”接口，数据包必须从一块网卡传输到另一块网卡，网卡的地址就是数据包的发送者和接收者的地址，称为MAC地址。

MAC地址，是网卡出厂时设定的一个全世界独一无二的地址，长度是48位，通常用12个十六进制数表示。比如：00-B0-D0-86-BB-F7

## 网络层

引进一套新的地址，使得可以区分不同计算机是否属于同一个子网络，这套地址叫做网络地址。先通过网络地址是用来确定计算机所在的子网络，再通过MAC地址确定目标网卡。

### IP协议和子网掩码

互联网上的每一台电脑都会分配到一个IP地址，地址分为两部分，前一部分代表网络，后一部分代表主机，通过子网掩码进行划分。

子网掩码用来判断IP地址是不是在同一个自网络。两个IP地址与子网掩码做一个二进制的AND运算，计算结果相同则两个设备在同一个子网络，否则不在。

子网掩码作用：

* 划分网络和主机：将IP地址的32位分成网络部分和主机部分，来标识特定的网络和该网络内的设备。
* 定义子网：允许网络管理员将一个巨大的网络划分成多个小网络，方便网络管理和分配IP地址。
* 路由决策：路由器使用子网掩码来确定数据包的目的地是否在本地子网内。
* 广播控制：用于确定哪些地址是用于广播的。

子网的表示方式：

* /24即255.255.255.0
* /16即255.255.0.0

### IP数据包

IP数据包直接放进以太网数据包的“数据”部分，即上层的变动不涉及下层的结构。IP数据包分为标头和数据两部分。

* 标头部分：版本，长度，IP地址等，长度为20-60字节
* 数据部分：IP数据包的具体内容，最长为65515字节

因为以太网数据包的数据部分最长只有1500，所以如果IP数据包超过了1500字节，就需要分割成几个以太网数据包，分开发送。

### ARP协议

IP数据包是放在以太网数据包里发送的，所以必须要同时知道对方的MAC地址以及对方的IP地址。

如果两台主机在同一个子网络，那么可以用ARP协议，得到对方的MAC地址。ARP协议通过发送一个数据包（包含在以太网数据包中），其中包含所要查询主机的IP地址，在对方的MAC地址一栏填的是：FF:FF:FF:FF:FF:FF表示这是一个广播地址。即它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身IP地址相比较，如果两者相投，则向对方报告自己的MAC地址，否则丢弃这个包。

如果两台主机不在同一个网络，则没有办法得到对方的MAC地址，需要将数据包发送到两个子网络连接处的网关，让网关去处理。

## 传输层

通过MAC地址和IP地址，两台主机可以建立通信了。但是同一台主机上有许多应用程序，即需要一个参数用来表示这个数据包是给哪个进程使用，这个参数叫做端口。端口是每一个使用网卡的程序的编号，每个数据会发送到主机的特定窗口。

端口是0-65535之间的一个整数，0-1023的端口被系统占用，用户只能选用大于1023的端口。

传输层的作用就是建立端口到端口的通信。网络层的作用是建立主机和主机之间的通信。所以确定主机和端口之后，就能实现程序之间的通信。Unix系统把主机和端口叫做套接字（socket）。

### UDP协议

只负责发送数据包，不保证数据包能否抵达对方，但是它实时性相对较好，传输效率较高。

### TCP协议

TCP是一个面向连接的，安全的，流式传输协议：

* 面向连接：是一个双向链接，通过三次握手完成，断开链接需要通过四次挥手完成。
* 安全：TCP通信过程中，会对发送的每一个数据包进行校验，如果发现数据丢失，会自动重传。
* 流式传输：发送端和接收端处理数据的速度，数据量都可以不一样。

## 应用层

规定应用程序的数据格式。应用层的常见协议：

* HTTP：用于从网站传输超文本到本地浏览器的传输协议
* HTTPS：HTTP的安全版本，用于安全的网页浏览
* FTP：用于在网络上进行文件传输的协议
* SMTP：用于发送电子邮件的协议
* POP3：用于接收电子邮件的协议
* DNS：用于将域名转换成IP地址的系统

# Internet协议

发送一个数据包需要知道两个地址：

* 对方的MAC地址
* 对方的IP地址

MAC地址具有局限性，如果两台电脑不在同一个子网络，就无法知道对方的MAC地址，必须通过网关（路由协议）转发。

## 静态IP地址上网

使用计算机上网之前，需要配置的四个参数：

* 本机的IP地址
* 子网掩码
* 网关的IP地址
* DNS的IP地址

## 动态IP地址上网

* DHCP服务器：每一个子网络中，有一台计算机负责管理本网络的所有IP地址。
* DHCP协议

  * 以太网标头设置本机MAC地址，和接收方MAC地址（因为还不知道，所以填一个广播地址）
  * IP标头设置发出方IP地址和接收方IP地址（两个地址都不知道，分别设置0.0.0.0/255.255.255.255）
  * UDP标头设置发出方端口（68）和接收方端口（67）
* 通过以太网协议广播发送，DHCP服务器通过查看发送方IP和接收方IP确定数据包是发给自己的。
* DHCP服务器读取包中的内容，分配IP地址，然后发送一个DHCP的相应。
* 新加入的计算机收到相应包，于是知道自己的IP地址，子网掩码，网关地址，DNS服务器等参数

## DNS服务器

* 通过已知的DNS服务器（例如8.8.8.8）来解析域名。向DNS服务器的IP地址发送DNS查询数据包。
* 数据包中包含想要解析的域名信息，比如www.google.com.
* DNS接收到请求之后，查找并返回域名对应的IP地址。
* 以上过程是自动完成的，不需要用户的配置或干预。一般在操作系统中，当在浏览器中输入一个网址时，系统自动处理DNS查询的过程。

# 字节序

## 小端（主机字节序）

数据的低位字节从存储到内存的低地址位，数据的高位字节存储到内存的高地址位（低低高高）。我们使用的PC机，数据存储默认使用的是小端。

举例：一百二十三即123，以小端的方式存储，内存地址从左到右为低地址到高地址，所以数据存储在内存上是：321

## 大端（网络字节序）

数据的低位字节存储到内存的高地址位，数据的高位字节，存储到内存的低地址位（低低高高）。套接字通信过程中操作的数据都是大端存储的，包括：接收和发送的数据，IP地址，端口号。

举例：一百二十三即123，以大端的方式存储，内存地址从左到右为低地址到高地址，所以数据存储在内存上是：123

# Reference

[互联网协议入门-阮一峰](https://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)
